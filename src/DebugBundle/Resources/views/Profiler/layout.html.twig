{% extends 'WebProfilerBundle:Profiler:layout.html.twig' %}

{% block toolbar %}
    {% set icon %}


        <img width="24" height="28" alt="Database" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAcCAYAAAB75n/uAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gkFCSwLfxzMFQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAMhSURBVEjH7ZZNaB1VFMd/5857mZhgbF+pH1ibviRtVCS6MIIacucRCBUUQVSEbsRFN4Lgyq10lZVKBHHnUsjGpQml781oBCkSEenC+DEa8aOaNDX1NS+ZmXtceFNek7ygUdBFDxzuMOfO+Z97/ufPHbhh/7XJ9hdjY2Nd5XL5kHNuEpgA7gOOAQf8/gy4DHwFfAbMGmOSLMua8/PzWUeA0dFR09vbO6KqrwDP/c1CC2BaRN6M4zhtDwRbD8PDwz2q+iEwto9OGOBh4NjQ0NBsmqat9sCWlYH+f9jyQedcZTvyn70S0X+B0wJwuwIURbEOvLXPxAo0gZnJycnv9pyiKIqeUNXTwABwCOgDbuqQcA34FfgCeD1Jko87TlGtVut2zr0oIm/HcdyMouiwqt4DHAEOAz2epxZwFbgIfA98niRJc3x8/Kgx5lFjzNl6vb68AyCKogOquupnewH4CLhgjFlsNBqXtldmrb1DRE6o6ghggQeA340xzzQajS+39pWuzWsQFHmeXwHuB0aAU0DunCusta6tNeLdqGrgc5R9/JwX4U4dpGm6Wa1WZ4C7gNt9rAyEnoPuNu/yibeUvQa8IyIvx3F8sRMHoXPuaeDdMAy7NjY2HvGnGQBuA3o9WAu4AvwIfC0in8RxfN5a2wc8FATBp/V6fWU3Dg6q6iVgFqgDCyLyTRiGS3Nzc8V2Dmq1Wreq9qvqceBB4DGgT0SejON4cQcHpVJpM8uyn4CT3pdV9bdWq7VmrV0Hci+kElByzvUAtwAH/QrwfhAEv3TUgbW2CkwBz+5DwW8EQTDVPqLXkTwxMVFyzg0kSTJdrVZfE5EF4GdPYAZs+nUFWALOA+8BZ5IkeT7P87OVSuXOwcHBPE3Tjb04mPYfpiKyHMdxs1PZURT1qeqtIjKkqi8A94rIU7tyYIzJi6JoAS95X1TVJWvtD8AqsO5PEHpVV1T1CFBV1aM+zQfGmNX2Iq4BOOeawOPAq/5OOOH9r9qMiEzleb68F8lSFEUYBEG/iJxU1XHgbi++m9vUfBn4FrgAnDPGzDnnVpIk2bzxF/L/sz8AAMY+LLGMa2cAAAAASUVORK5CYII=">
        <span class="sf-toolbar-status sf-toolbar-info-piece-additional">
            <span class="sf-toolbar-info-class">{{ collector.queryCount }}</span>
        </span>
        <span class="sf-toolbar-info-piece-additional-detail">in <i>{{ collector.queryTime|round }} ms</i></span>
    {% endset %}
    {% set text %}
    <div class="sf-toolbar-info-piece">
        <b>Query count</b>
        <span>{{ collector.queryCount }}</span>
    </div>
    <div class="sf-toolbar-info-piece">
        <b>Time spent</b>
        <span>{{ collector.queryTime|round }} ms</span>
    </div>
    {% endset %}
    {% include '@WebProfiler/Profiler/toolbar_item.html.twig' with { 'link': profiler_url } %}
{% endblock %}

{% block menu %}
    <span class="label">
        <span class="icon"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAB4ElEQVR4nO3Wz4tNYRgH8M81Q9MYGjQWSkhjpIZCfi1cGgt2thZKSjaaLYtZsBixUBYoKxQ7f4CVGBMxbEaI8XtBU0xihiHF4nlP997TrTFn7tK3ns573nPO832f9/t+n06pXC7LoQM92IpVWIkFmIs5mEjxASN4gpt4gN/5ZKUqgu04ht0o5V/8B4zhAs7iczY5K12P4jb2FEwOC9GHYVF1DcHxgknrYQkO5wlaGkgArXmCyQYTfM8TnGhg8o+4mCc4hTJu4E/BxGPoRzdeZZPN6dqOgRQd2IUt6FLrg9mi/PG00mof3FfxQTu+UPHBKM7gShoXQQnb0Jty9FZXsBincRIPcQ/P8ALv0orH8StV0ibOfadw+1rsEEcUzmesGcEjbEATNqeYCYayQSZyT6qg6PZkGMResdWoVLBc9KE+bBJ7uQ4rsBTzhXmahWcm8Alv8VIIfAfv06K78biaYAiXcQ53U0wXLdgn+togjlQTNOFQihHcEsfvKd7gK74JkdswD4uwGmuEfuX0jGicqgmuYX8ad6Yoiklcz24ykQ/goGi1RfETV7Fe6IFKBd24lKILO7FRuHiZcGarcPIPIfIoXuN5SjggtnJKkYfTR9PFf5GnRF2RS3V+W2Yqcg3+Avb0hDzHNXZpAAAAAElFTkSuQmCC" alt=""/></span>
        <strong>Database</strong>
    </span>
{% endblock %}

{% block panel %}
    {# the panel content #}
    <style type="text/css">
        .backtrace {
            display: none;
        }
        .queryTable th {
            width: 200px;
        }
    </style>

    <p><a href="#queriesOccurrence">To queries by number of occurrence</a></p>


    <h2>Queried database tables ordered by number of occurrence</h2>

    <strong style="color: #759e1a">{{ collector.queriedTables|length }}</strong> unique tables were queried.<br /><br />

    <table class="queryTable">
        <tbody>
            <tr>
                <th>Table</th>
                <th>Number of occurrences</th>
            </tr>
            {% for table, amount in collector.queriedTables %}
            <tr>
                <td>{{ table }}</td>
                <td>{{ amount }}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>


    <h2 id="queriesOccurrence">Database queries ordered by number of occurrence</h2>

    <strong style="color: #759e1a">{{ collector.queriesByOccurrence | length }}</strong> unique queries were executed / <strong style="color: #759e1a">{{ collector.queryCount }}</strong> total<br /><br />

    {% if not collector.backtraceEnabled %}
    Backtrace for query not enabled, set configuration value 'backtrace_enabled' for bundle 'chameleon_system_debug' to 'true' to enable it. Keep in mind that enabling backtrace consumes enormous amounts of memory, you can limit backtrace by setting configuration value 'backtrace_limit'.<br /><br />
    {% else %}
        Current backtrace limit is <strong>{{ collector.backtraceLimit }}</strong>, change it using configuration value 'backtrace_limit' for bundle 'chameleon_system_debug'. Keep in mind that increasing the limit increases memory usage.<br /><br />
    {% endif %}

    {% for aQuery in collector.queriesByOccurrence %}
        {% set outerLoopIndex = loop.index %}
        <h3>Query #{{ loop.index }}</h3>
        <table class="queryTable">
            <tbody>
            <tr>
                <th>Query</th>
                <td><pre>{{ aQuery.query }}</pre></td>
            </tr>
            <tr>
                <th>Number of occurrences</th>
                <td><pre>{{ aQuery.count }}</pre></td>
            </tr>
            <tr>
                <th>Total execution time</th>
                <td><pre>{{ aQuery.time|round(1) }} ms</pre></td>
            </tr>
            {% if collector.backtraceEnabled %}
            <tr>
                <th>Backtrace</th>
                <td>
                    <ul class="alt">
                        {% for caller in aQuery.caller %}
                            <li class="{{ cycle(['odd', 'even'], loop.index) }}">
                                {% set id = 'backtrace' ~ outerLoopIndex ~ '-' ~ loop.index %}
                                <a href="#" onclick="Sfjs.toggle('{{ id|e('js') }}', document.getElementById('{{ id|e('js') }}-on'), document.getElementById('{{ id|e('js') }}-off')); return false;">
                                    #{{ caller }}
                                    <img class="toggle" id="{{ id }}-off" alt="-" src="data:image/gif;base64,R0lGODlhEgASAMQSANft94TG57Hb8GS44ez1+mC24IvK6ePx+Wa44dXs92+942e54o3L6W2844/M6dnu+P/+/l614P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABIALAAAAAASABIAQAVCoCQBTBOd6Kk4gJhGBCTPxysJb44K0qD/ER/wlxjmisZkMqBEBW5NHrMZmVKvv9hMVsO+hE0EoNAstEYGxG9heIhCADs=" style="display:none">
                                    <img class="toggle" id="{{ id }}-on" alt="+" src="data:image/gif;base64,R0lGODlhEgASAMQTANft99/v+Ga44bHb8ITG52S44dXs9+z1+uPx+YvK6WC24G+944/M6W28443L6dnu+Ge54v/+/l614P///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABMALAAAAAASABIAQAVS4DQBTiOd6LkwgJgeUSzHSDoNaZ4PU6FLgYBA5/vFID/DbylRGiNIZu74I0h1hNsVxbNuUV4d9SsZM2EzWe1qThVzwWFOAFCQFa1RQq6DJB4iIQA7" style="display:inline">
                                </a>
                                <div class="backtrace" id="{{ id }}">
                                    <pre>{{ dump(aQuery.backtrace[loop.index-1]) }}</pre>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </td>
            </tr>
            {% endif %}
            </tbody>
        </table>
    {% endfor %}
{% endblock %}
